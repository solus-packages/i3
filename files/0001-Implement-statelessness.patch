From 037a6fa3acbcf7fff926ac6483ba41b74fb04af0 Mon Sep 17 00:00:00 2001
From: Joshua Strobl <joshua@stroblindustries.com>
Date: Wed, 1 Mar 2017 23:00:32 +0200
Subject: [PATCH 1/1] Implement statelessness.

---
 Makefile.am             | 2 +-
 i3-config-wizard/main.c | 4 ++--
 libi3/get_config_path.c | 8 +++++++-
 3 files changed, 10 insertions(+), 4 deletions(-)

diff --git a/Makefile.am b/Makefile.am
index 0368ecca..8869bc05 100644
--- a/Makefile.am
+++ b/Makefile.am
@@ -30,7 +30,7 @@ dist_bin_SCRIPTS = \
 	i3-sensible-pager \
 	i3-sensible-terminal
 
-i3confdir = $(sysconfdir)/i3
+i3confdir = /usr/share/defaults/i3
 dist_i3conf_DATA = \
 	etc/config \
 	etc/config.keycodes
diff --git a/i3-config-wizard/main.c b/i3-config-wizard/main.c
index dd58fd12..57512a22 100644
--- a/i3-config-wizard/main.c
+++ b/i3-config-wizard/main.c
@@ -653,9 +653,9 @@ static void finish() {
     if ((xkb_keymap = xkb_x11_keymap_new_from_device(xkb_context, conn, device_id, 0)) == NULL)
         errx(1, "xkb_x11_keymap_new_from_device failed");
 
-    FILE *kc_config = fopen(SYSCONFDIR "/i3/config.keycodes", "r");
+    FILE *kc_config = fopen("/usr/share/defaults/i3/config.keycodes", "r");
     if (kc_config == NULL)
-        err(1, "Could not open input file \"%s\"", SYSCONFDIR "/i3/config.keycodes");
+        err(1, "Could not open input file \"%s\"", "/usr/share/defaults/i3/config.keycodes");
 
     FILE *ks_config = fopen(config_path, "w");
     if (ks_config == NULL)
diff --git a/libi3/get_config_path.c b/libi3/get_config_path.c
index efece5cd..d5596ee1 100644
--- a/libi3/get_config_path.c
+++ b/libi3/get_config_path.c
@@ -69,7 +69,13 @@ char *get_config_path(const char *override_configpath, bool use_system_paths) {
     if (path_exists(config_path))
         return sstrdup(config_path);
 
-    /* 4: check for $XDG_CONFIG_DIRS/i3/config */
+    /* 4: check stateless directory */
+    config_path = "/usr/share/defaults/i3/config";
+    if (path_exists(config_path))
+        return config_path;
+    free(config_path);
+
+    /* 5: check for $XDG_CONFIG_DIRS/i3/config */
     if ((xdg_config_dirs = getenv("XDG_CONFIG_DIRS")) == NULL)
         xdg_config_dirs = SYSCONFDIR "/xdg";
 
-- 
2.12.2

