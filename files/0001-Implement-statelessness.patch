From 180eeda5210b5f4d109796ac74822470570266ba Mon Sep 17 00:00:00 2001
From: Joshua Strobl <joshua@stroblindustries.com>
Date: Tue, 29 Jan 2019 15:02:56 +0200
Subject: [PATCH 1/1] Implement statelessness.

---
 Makefile.am             |  2 +-
 i3-config-wizard/main.c |  4 ++--
 libi3/get_config_path.c | 10 ++++++++--
 3 files changed, 11 insertions(+), 5 deletions(-)

diff --git a/Makefile.am b/Makefile.am
index ee71b7f..769361b 100644
--- a/Makefile.am
+++ b/Makefile.am
@@ -30,7 +30,7 @@ dist_bin_SCRIPTS = \
 	i3-sensible-pager \
 	i3-sensible-terminal
 
-i3confdir = $(sysconfdir)/i3
+i3confdir = /usr/share/defaults/i3
 dist_i3conf_DATA = \
 	etc/config \
 	etc/config.keycodes
diff --git a/i3-config-wizard/main.c b/i3-config-wizard/main.c
index 4b55665..f8cd5e0 100644
--- a/i3-config-wizard/main.c
+++ b/i3-config-wizard/main.c
@@ -653,9 +653,9 @@ static void finish(void) {
     if ((xkb_keymap = xkb_x11_keymap_new_from_device(xkb_context, conn, device_id, 0)) == NULL)
         errx(1, "xkb_x11_keymap_new_from_device failed");
 
-    FILE *kc_config = fopen(SYSCONFDIR "/i3/config.keycodes", "r");
+    FILE *kc_config = fopen("/usr/share/defaults/i3/config.keycodes", "r");
     if (kc_config == NULL)
-        err(1, "Could not open input file \"%s\"", SYSCONFDIR "/i3/config.keycodes");
+        err(1, "Could not open input file \"%s\"", "/usr/share/defaults/i3/config.keycodes");
 
     FILE *ks_config = fopen(config_path, "w");
     if (ks_config == NULL)
diff --git a/libi3/get_config_path.c b/libi3/get_config_path.c
index 4909e11..4842abf 100644
--- a/libi3/get_config_path.c
+++ b/libi3/get_config_path.c
@@ -69,7 +69,13 @@ char *get_config_path(const char *override_configpath, bool use_system_paths) {
         return NULL;
     }
 
-    /* 3: check for $XDG_CONFIG_DIRS/i3/config */
+    /* 3: check stateless directory */
+    config_path = "/usr/share/defaults/i3/config";
+    if (path_exists(config_path))
+        return config_path;
+    free(config_path);
+
+    /* 4: check for $XDG_CONFIG_DIRS/i3/config */
     if ((xdg_config_dirs = getenv("XDG_CONFIG_DIRS")) == NULL) {
         xdg_config_dirs = SYSCONFDIR "/xdg";
     }
@@ -89,7 +95,7 @@ char *get_config_path(const char *override_configpath, bool use_system_paths) {
     }
     free(buf);
 
-    /* 4: check the traditional path under /etc */
+    /* 5: check the traditional path under /etc */
     config_path = SYSCONFDIR "/i3/config";
     if (path_exists(config_path)) {
         return sstrdup(config_path);
-- 
2.20.1

